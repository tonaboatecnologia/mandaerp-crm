<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Diagnóstico ERP - PWA</title>
    <meta name="description" content="Sistema avançado de registro e análise de questionários de diagnóstico ERP">
    <meta name="theme-color" content="#4361ee">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Diagnóstico ERP">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" as="script">
    
    <style>
        /* CSS Variables for theming */
        :root {
            /* Primary Colors */
            --primary: #4361ee;
            --primary-dark: #3651d4;
            --primary-light: #5a7dff;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            
            /* Semantic Colors */
            --success: #06ffa5;
            --success-dark: #05d68a;
            --warning: #ffbe0b;
            --danger: #f72585;
            --danger-dark: #d6196f;
            --info: #4cc9f0;
            
            /* Neutral Colors */
            --dark: #212529;
            --gray-dark: #495057;
            --gray: #6c757d;
            --gray-light: #adb5bd;
            --gray-lighter: #dee2e6;
            --light: #f8f9fa;
            --white: #ffffff;
            
            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 50%;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 300ms ease;
            --transition-slow: 500ms ease;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* Z-index */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
        }

        /* Dark Theme Variables */
        [data-theme="dark"] {
            --dark: #f8f9fa;
            --gray-dark: #adb5bd;
            --gray: #dee2e6;
            --gray-light: #495057;
            --gray-lighter: #343a40;
            --light: #212529;
            --white: #1a1d20;
            
            --card-bg: #2d3748;
            --body-bg: #1a202c;
            --border-color: #4a5568;
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        [data-theme="dark"] body {
            background-color: var(--body-bg);
            color: var(--dark);
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            line-height: 1.2;
            margin-bottom: var(--space-md);
        }

        h1 { font-size: var(--font-size-4xl); }
        h2 { font-size: var(--font-size-3xl); }
        h3 { font-size: var(--font-size-2xl); }
        h4 { font-size: var(--font-size-xl); }
        h5 { font-size: var(--font-size-lg); }
        h6 { font-size: var(--font-size-base); }

        p {
            margin-bottom: var(--space-md);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
            line-height: 1.5;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width var(--transition-normal), height var(--transition-normal);
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff9500);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #3db9e8);
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }

        .btn-ghost {
            background: transparent;
            color: var(--gray);
        }

        .btn-ghost:hover {
            background: var(--gray-lighter);
            color: var(--dark);
        }

        .btn-icon {
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            width: 40px;
            height: 40px;
        }

        .btn-sm {
            padding: var(--space-xs) var(--space-sm);
            font-size: var(--font-size-xs);
        }

        .btn-lg {
            padding: var(--space-md) var(--space-lg);
            font-size: var(--font-size-lg);
        }

        .btn-group {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        /* Forms */
        .form-control {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--dark);
            background-color: var(--white);
            border: 2px solid var(--gray-lighter);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        [data-theme="dark"] .form-control {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            color: var(--dark);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 600;
            font-size: var(--font-size-sm);
            color: var(--gray-dark);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-sm);
            cursor: pointer;
        }

        .form-check input {
            margin-right: var(--space-sm);
            cursor: pointer;
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        [data-theme="dark"] .card {
            background: var(--card-bg);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .card-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--gray-lighter);
            background: linear-gradient(135deg, var(--white), var(--light));
        }

        [data-theme="dark"] .card-header {
            background: linear-gradient(135deg, var(--card-bg), var(--body-bg));
            border-bottom-color: var(--border-color);
        }

        .card-body {
            padding: var(--space-lg);
        }

        .card-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--gray-lighter);
            background: var(--light);
        }

        [data-theme="dark"] .card-footer {
            background: var(--body-bg);
            border-top-color: var(--border-color);
        }

        /* Grid System */
        .grid {
            display: grid;
            gap: var(--space-lg);
        }

        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .grid-cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
        .grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }

        /* Responsive Grid */
        @media (max-width: 1024px) {
            .grid-cols-6 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .grid-cols-5 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .grid-cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }

        @media (max-width: 768px) {
            .grid-cols-6, .grid-cols-5, .grid-cols-4, .grid-cols-3 { 
                grid-template-columns: repeat(1, minmax(0, 1fr)); 
            }
        }

        /* Flex Utilities */
        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-2 { gap: var(--space-sm); }
        .gap-3 { gap: var(--space-md); }
        .gap-4 { gap: var(--space-lg); }
        .gap-5 { gap: var(--space-xl); }

        /* Spacing Utilities */
        .m-1 { margin: var(--space-xs); }
        .m-2 { margin: var(--space-sm); }
        .m-3 { margin: var(--space-md); }
        .m-4 { margin: var(--space-lg); }
        .m-5 { margin: var(--space-xl); }

        .p-1 { padding: var(--space-xs); }
        .p-2 { padding: var(--space-sm); }
        .p-3 { padding: var(--space-md); }
        .p-4 { padding: var(--space-lg); }
        .p-5 { padding: var(--space-xl); }

        .mt-1 { margin-top: var(--space-xs); }
        .mt-2 { margin-top: var(--space-sm); }
        .mt-3 { margin-top: var(--space-md); }
        .mt-4 { margin-top: var(--space-lg); }
        .mt-5 { margin-top: var(--space-xl); }

        .mb-1 { margin-bottom: var(--space-xs); }
        .mb-2 { margin-bottom: var(--space-sm); }
        .mb-3 { margin-bottom: var(--space-md); }
        .mb-4 { margin-bottom: var(--space-lg); }
        .mb-5 { margin-bottom: var(--space-xl); }

        /* Container */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-lg);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-md);
            }
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: var(--space-lg) 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            backdrop-filter: blur(10px);
            background-attachment: fixed;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .logo-section h1 {
            font-size: var(--font-size-2xl);
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .logo-section p {
            font-size: var(--font-size-sm);
            margin: 0;
            opacity: 0.9;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: var(--white);
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 1.2rem;
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
        }

        .notification-bell:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger);
            color: var(--white);
            border-radius: var(--radius-full);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xs);
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            background: rgba(255,255,255,0.1);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            backdrop-filter: blur(10px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--accent), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: var(--font-size-lg);
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            padding-top: var(--space-2xl);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-2xl);
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-normal);
        }

        [data-theme="dark"] .stat-card {
            background: var(--card-bg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, transparent, rgba(67, 97, 238, 0.1));
            border-radius: 0 0 0 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-2xl);
            margin-bottom: var(--space-md);
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: var(--white);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: var(--font-size-3xl);
            font-weight: bold;
            color: var(--dark);
            margin-bottom: var(--space-xs);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-trend {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            font-size: var(--font-size-sm);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--danger);
        }

        /* Filters Section */
        .filters-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
        }

        [data-theme="dark"] .filters-section {
            background: var(--card-bg);
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md) var(--space-sm) var(--space-xl);
            border: 2px solid var(--gray-lighter);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .search-icon {
            position: absolute;
            left: var(--space-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .view-toggle {
            display: flex;
            gap: var(--space-xs);
            background: var(--gray-lighter);
            padding: var(--space-xs);
            border-radius: var(--radius-md);
        }

        .view-btn {
            padding: var(--space-xs) var(--space-sm);
            border: none;
            background: transparent;
            color: var(--gray);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .view-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Records Section */
        .records-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        [data-theme="dark"] .records-section {
            background: var(--card-bg);
        }

        .records-header {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--gray-lighter);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        [data-theme="dark"] .records-header {
            border-bottom-color: var(--border-color);
        }

        /* Table View */
        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--gray-lighter);
        }

        [data-theme="dark"] .data-table th,
        [data-theme="dark"] .data-table td {
            border-bottom-color: var(--border-color);
        }

        .data-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--gray-dark);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        [data-theme="dark"] .data-table th {
            background: var(--body-bg);
            color: var(--gray-light);
        }

        .data-table tr {
            transition: background-color var(--transition-fast);
        }

        .data-table tbody tr:hover {
            background: var(--gray-lighter);
        }

        [data-theme="dark"] .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Card View */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-lg);
            padding: var(--space-lg);
        }

        .record-card {
            background: var(--light);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            border: 1px solid var(--gray-lighter);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .record-card {
            background: var(--body-bg);
            border-color: var(--border-color);
        }

        .record-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .record-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--space-md);
        }

        .record-company {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--dark);
            margin-bottom: var(--space-xs);
        }

        .record-id {
            font-size: var(--font-size-xs);
            color: var(--gray);
            background: var(--gray-lighter);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
        }

        .record-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
        }

        .record-tag {
            font-size: var(--font-size-xs);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        .tag-sector {
            background: var(--primary-light);
            color: var(--white);
        }

        .tag-urgency {
            background: var(--danger);
            color: var(--white);
        }

        .tag-urgency-medium {
            background: var(--warning);
            color: var(--white);
        }

        .tag-urgency-low {
            background: var(--success);
            color: var(--white);
        }

        .record-date {
            font-size: var(--font-size-sm);
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .record-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        /* Compact View */
        .compact-list {
            padding: var(--space-lg);
        }

        .compact-item {
            display: flex;
            align-items: center;
            padding: var(--space-md);
            border-bottom: 1px solid var(--gray-lighter);
            transition: all var(--transition-fast);
        }

        [data-theme="dark"] .compact-item {
            border-bottom-color: var(--border-color);
        }

        .compact-item:hover {
            background: var(--gray-lighter);
        }

        [data-theme="dark"] .compact-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .compact-checkbox {
            margin-right: var(--space-md);
        }

        .compact-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .compact-info {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .compact-company {
            font-weight: 600;
            color: var(--dark);
        }

        .compact-meta {
            font-size: var(--font-size-xs);
            color: var(--gray);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-lg);
            flex-wrap: wrap;
        }

        .page-btn {
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--gray-lighter);
            background: var(--white);
            color: var(--dark);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
        }

        [data-theme="dark"] .page-btn {
            background: var(--card-bg);
            border-color: var(--border-color);
            color: var(--dark);
        }

        .page-btn:hover:not(:disabled) {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .page-btn.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-size: var(--font-size-sm);
            color: var(--gray);
            padding: var(--space-sm) var(--space-md);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: var(--z-modal);
            backdrop-filter: blur(5px);
            animation: fadeIn var(--transition-normal);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            background: var(--white);
            margin: 2% auto;
            padding: 0;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            animation: slideUp var(--transition-normal);
        }

        [data-theme="dark"] .modal-content {
            background: var(--card-bg);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--gray-lighter);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        [data-theme="dark"] .modal-header {
            border-bottom-color: var(--border-color);
        }

        .modal-title {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            color: var(--gray);
            cursor: pointer;
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--gray-lighter);
            color: var(--dark);
        }

        .modal-body {
            padding: var(--space-xl);
            max-height: calc(90vh - 200px);
            overflow-y: auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--gray-lighter);
            margin-bottom: var(--space-xl);
            overflow-x: auto;
        }

        [data-theme="dark"] .tabs {
            border-bottom-color: var(--border-color);
        }

        .tab {
            padding: var(--space-md) var(--space-lg);
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: var(--font-size-base);
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn var(--transition-normal);
        }

        /* Form Elements */
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            margin-top: var(--space-sm);
        }

        .radio-group label,
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            font-weight: normal;
        }

        .radio-group input,
        .checkbox-group input {
            cursor: pointer;
        }

        /* Notifications */
        .notifications-modal .modal-content {
            max-width: 600px;
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: var(--space-md);
            border-bottom: 1px solid var(--gray-lighter);
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            transition: background-color var(--transition-fast);
        }

        [data-theme="dark"] .notification-item {
            border-bottom-color: var(--border-color);
        }

        .notification-item:hover {
            background: var(--gray-lighter);
        }

        [data-theme="dark"] .notification-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .notification-item.unread {
            background: linear-gradient(90deg, rgba(67, 97, 238, 0.1), transparent);
            border-left: 4px solid var(--primary);
        }

        .notification-icon {
            font-size: var(--font-size-xl);
            color: var(--primary);
            margin-top: var(--space-xs);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: var(--space-xs);
            color: var(--dark);
        }

        .notification-message {
            color: var(--gray);
            margin-bottom: var(--space-xs);
            font-size: var(--font-size-sm);
        }

        .notification-time {
            font-size: var(--font-size-xs);
            color: var(--gray-light);
        }

        .notification-actions {
            display: flex;
            gap: var(--space-sm);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            min-width: 300px;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            color: var(--white);
            font-weight: 500;
            z-index: var(--z-toast);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            animation: slideInRight var(--transition-normal);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
        }

        .toast.error {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
        }

        .toast.warning {
            background: linear-gradient(135deg, var(--warning), #ff9500);
        }

        .toast.info {
            background: linear-gradient(135deg, var(--info), #3db9e8);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: var(--font-size-lg);
            opacity: 0.7;
            transition: opacity var(--transition-fast);
        }

        .toast-close:hover {
            opacity: 1;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: var(--space-3xl) var(--space-xl);
            color: var(--gray);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: var(--space-lg);
            opacity: 0.3;
        }

        .empty-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--gray-dark);
            margin-bottom: var(--space-sm);
        }

        .empty-description {
            color: var(--gray);
            margin-bottom: var(--space-lg);
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--gray-lighter);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, var(--gray-lighter) 25%, var(--gray-light) 50%, var(--gray-lighter) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            height: 200px;
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
        }

        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--warning);
            color: var(--white);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            display: none;
            z-index: var(--z-tooltip);
            box-shadow: var(--shadow-lg);
            animation: slideInRight var(--transition-normal);
        }

        .offline-indicator.show {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        /* Sync Status */
        .sync-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: var(--white);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            display: none;
            z-index: var(--z-tooltip);
            box-shadow: var(--shadow-lg);
            animation: slideInRight var(--transition-normal);
        }

        .sync-status.show {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .sync-status.error {
            background: var(--danger);
        }

        .sync-status i {
            animation: spin 1s linear infinite;
        }

        /* Install Banner */
        .install-banner {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--primary);
            color: var(--white);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            display: none;
            z-index: var(--z-tooltip);
            box-shadow: var(--shadow-lg);
            animation: slideInUp var(--transition-normal);
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .install-banner.show {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .install-banner button {
            background: var(--white);
            color: var(--primary);
            border: none;
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .install-banner button:hover {
            transform: scale(1.05);
        }

        /* Login Container */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: var(--space-lg);
        }

        .login-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            padding: var(--space-2xl);
            width: 100%;
            max-width: 400px;
            animation: slideUp var(--transition-normal);
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--space-2xl);
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-lg);
            font-size: var(--font-size-3xl);
            color: var(--white);
        }

        .login-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--space-sm);
        }

        .login-subtitle {
            color: var(--gray);
            font-size: var(--font-size-sm);
        }

        .credentials-info {
            margin-top: var(--space-xl);
            padding: var(--space-md);
            background: var(--gray-lighter);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
        }

        .credentials-info h4 {
            margin-bottom: var(--space-sm);
            color: var(--gray-dark);
        }

        .credentials-info p {
            margin-bottom: var(--space-xs);
            color: var(--gray);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .action-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            html {
                font-size: 14px;
            }

            .container {
                padding: 0 var(--space-md);
            }

            .dashboard {
                padding-top: var(--space-xl);
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: var(--space-md);
            }

            .filter-row {
                grid-template-columns: 1fr;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 5% auto;
                width: 95%;
            }

            .modal-body {
                padding: var(--space-lg);
            }

            .tabs {
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: var(--space-sm) var(--space-md);
                font-size: var(--font-size-sm);
            }

            .record-actions {
                flex-wrap: wrap;
            }

            .data-table {
                font-size: var(--font-size-sm);
            }

            .data-table th,
            .data-table td {
                padding: var(--space-sm);
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: var(--space-xl);
            }

            .modal-content {
                margin: 2% auto;
                width: 98%;
                border-radius: var(--radius-lg);
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Print Styles */
        @media print {
            header,
            .action-bar,
            .filters-section,
            .btn,
            .modal,
            .toast,
            .offline-indicator,
            .sync-status,
            .install-banner {
                display: none !important;
            }

            .dashboard {
                display: block !important;
                padding: 0;
            }

            .card {
                box-shadow: none;
                border: 1px solid var(--gray-lighter);
                page-break-inside: avoid;
            }

            .record-card {
                break-inside: avoid;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --primary: #0066cc;
                --secondary: #004499;
                --success: #00aa44;
                --warning: #ff8800;
                --danger: #cc0000;
            }

            .btn {
                border: 2px solid currentColor;
            }

            .form-control {
                border: 2px solid var(--dark);
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus Visible */
        *:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-lighter);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-dark);
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: var(--border-color);
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: var(--gray-light);
        }

        /* Selection */
        ::selection {
            background: var(--primary);
            color: var(--white);
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h2 class="login-title">Diagnóstico ERP</h2>
                <p class="login-subtitle">Sistema avançado de gestão de questionários</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="username">Usuário</label>
                    <input type="text" id="username" class="form-control" placeholder="Digite seu usuário" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Senha</label>
                    <input type="password" id="password" class="form-control" placeholder="Digite sua senha" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: var(--space-lg);">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </form>
            
            <div class="credentials-info">
                <h4>Credenciais de Acesso</h4>
                <p><strong>Administrador:</strong> admin / admin123</p>
                <p><strong>Funcionário:</strong> funcionario / func123</p>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo-section">
                        <i class="fas fa-clipboard-check" style="font-size: 2rem;"></i>
                        <div>
                            <h1>Diagnóstico ERP</h1>
                            <p>Sistema avançado de gestão de questionários</p>
                        </div>
                    </div>
                    
                    <div class="user-section">
                        <button class="theme-toggle" id="themeToggle" title="Alternar tema">
                            <i class="fas fa-moon"></i>
                        </button>
                        
                        <div class="notification-bell" id="notificationBell" title="Notificações">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge">0</span>
                        </div>
                        
                        <div class="user-info">
                            <div class="user-avatar" id="userAvatar">A</div>
                            <div>
                                <div id="currentUser" style="font-weight: 600;">Usuário</div>
                                <div id="userRole" style="font-size: var(--font-size-sm); opacity: 0.8;">Função</div>
                            </div>
                            <button class="btn btn-danger btn-sm" id="logoutBtn" title="Sair">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-value" id="totalRecords">0</div>
                    <div class="stat-label">Total de Questionários</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>12%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, var(--success), var(--success-dark));">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-value" id="totalCompanies">0</div>
                    <div class="stat-label">Empresas Cadastradas</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>8%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, var(--warning), #ff9500);">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-value" id="thisMonthRecords">0</div>
                    <div class="stat-label">Registros Este Mês</div>
                    <div class="stat-trend trend-down">
                        <i class="fas fa-arrow-down"></i>
                        <span>3%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, var(--danger), var(--danger-dark));">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value" id="highPriorityRecords">0</div>
                    <div class="stat-label">Alta Prioridade</div>
                    <div class="stat-trend trend-up">
                        <i class="fas fa-arrow-up"></i>
                        <span>15%</span>
                    </div>
                </div>
            </div>

            <!-- Advanced Filters (Admin Only) -->
            <div id="advancedFilters" class="filters-section" style="display: none;">
                <div class="filters-header">
                    <h3><i class="fas fa-filter"></i> Filtros Avançados</h3>
                    <button class="btn btn-sm btn-outline" id="toggleFilters">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                
                <div id="filtersContent">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="form-label">Período</label>
                            <div style="display: flex; gap: var(--space-sm);">
                                <input type="date" id="filterStartDate" class="form-control" placeholder="Data inicial">
                                <input type="date" id="filterEndDate" class="form-control" placeholder="Data final">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label class="form-label">Setor</label>
                            <select id="filterSetor" class="form-control">
                                <option value="">Todos os setores</option>
                                <option value="Comércio">Comércio</option>
                                <option value="Saúde">Saúde</option>
                                <option value="Educação">Educação</option>
                                <option value="Construção">Construção</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="form-label">Urgência</label>
                            <select id="filterUrgencia" class="form-control">
                                <option value="">Todas as urgências</option>
                                <option value="Alta">Alta</option>
                                <option value="Média">Média</option>
                                <option value="Baixa">Baixa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filter-actions">
                        <button class="btn btn-primary" id="applyFilters">
                            <i class="fas fa-search"></i> Aplicar Filtros
                        </button>
                        <button class="btn btn-ghost" id="clearFilters">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="action-bar">
                <div class="btn-group">
                    <button class="btn btn-primary" id="newFormBtn">
                        <i class="fas fa-plus"></i> Novo Questionário
                    </button>
                    <button class="btn btn-success" id="exportCsvBtn">
                        <i class="fas fa-file-csv"></i> Exportar CSV
                    </button>
                    <button class="btn btn-info" id="exportPdfBtn">
                        <i class="fas fa-file-pdf"></i> Relatório PDF
                    </button>
                </div>
                
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Buscar por empresa ou setor...">
                </div>
                
                <div class="view-toggle">
                    <button class="view-btn active" data-view="table" title="Visão em tabela">
                        <i class="fas fa-table"></i>
                    </button>
                    <button class="view-btn" data-view="cards" title="Visão em cards">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button class="view-btn" data-view="compact" title="Visão compacta">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>

            <!-- Records Section -->
            <div class="records-section">
                <div class="records-header">
                    <h3><i class="fas fa-clipboard-list"></i> Questionários Registrados</h3>
                    <span id="recordCount" style="color: var(--gray);">0 registros</span>
                </div>
                
                <!-- Table View -->
                <div id="tableView" class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Empresa</th>
                                <th>Setor</th>
                                <th>Urgência</th>
                                <th>Data</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Table rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Cards View -->
                <div id="cardsView" class="cards-grid" style="display: none;">
                    <!-- Cards will be inserted here -->
                </div>
                
                <!-- Compact View -->
                <div id="compactView" class="compact-list" style="display: none;">
                    <!-- Compact items will be inserted here -->
                </div>
                
                <!-- Pagination -->
                <div id="paginationContainer" class="pagination" style="display: none;">
                    <button class="page-btn" id="prevPage">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div id="pageNumbers"></div>
                    <button class="page-btn" id="nextPage">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <div class="page-info">
                        <span id="paginationInfo"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form -->
    <div id="formModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Novo Questionário</h2>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab active" data-tab="perfil">Perfil da Empresa</button>
                    <button class="tab" data-tab="processos">Diagnóstico de Processos</button>
                    <button class="tab" data-tab="necessidades">Necessidades Específicas</button>
                    <button class="tab" data-tab="expectativas">Expectativas e Decisão</button>
                    <button class="tab" data-tab="analise">Análise do Consultor</button>
                </div>
                
                <form id="diagnosisForm">
                    <!-- Tab content will be inserted here -->
                </form>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-bell"></i> Notificações</h2>
                <button class="btn btn-sm btn-primary" id="markAllRead">
                    <i class="fas fa-check-double"></i> Marcar todas como lidas
                </button>
                <button class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="notificationsList" class="notifications-list">
                    <!-- Notifications will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Install Banner -->
    <div class="install-banner" id="installBanner">
        <div>Instale este aplicativo para acesso offline e melhor experiência</div>
        <button id="installBtn">Instalar</button>
    </div>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fas fa-wifi-slash"></i> Você está offline
    </div>

    <!-- Sync Status -->
    <div id="syncStatus" class="sync-status">
        <i class="fas fa-sync-alt"></i> Sincronizando dados...
    </div>

    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <script>
        // Global Variables
        let records = [];
        let notifications = [];
        let currentUser = null;
        let currentEditId = null;
        let deferredPrompt;
        let currentPage = 1;
        const recordsPerPage = 10;
        let filteredRecords = [];
        let isOnline = navigator.onLine;
        let currentView = 'table';
        let isFiltersExpanded = true;

        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const themeToggle = document.getElementById('themeToggle');
        const notificationBell = document.getElementById('notificationBell');
        const notificationBadge = document.getElementById('notificationBadge');
        const notificationsModal = document.getElementById('notificationsModal');
        const notificationsList = document.getElementById('notificationsList');
        const markAllReadBtn = document.getElementById('markAllRead');
        const formModal = document.getElementById('formModal');
        const newFormBtn = document.getElementById('newFormBtn');
        const exportCsvBtn = document.getElementById('exportCsvBtn');
        const exportPdfBtn = document.getElementById('exportPdfBtn');
        const searchInput = document.getElementById('searchInput');
        const recordCount = document.getElementById('recordCount');
        const diagnosisForm = document.getElementById('diagnosisForm');
        const modalTitle = document.getElementById('modalTitle');
        const modalCloseBtns = document.querySelectorAll('.modal-close');
        const installBanner = document.getElementById('installBanner');
        const installBtn = document.getElementById('installBtn');
        const offlineIndicator = document.getElementById('offlineIndicator');
        const syncStatus = document.getElementById('syncStatus');
        
        // View elements
        const tableView = document.getElementById('tableView');
        const cardsView = document.getElementById('cardsView');
        const compactView = document.getElementById('compactView');
        const tableBody = document.getElementById('tableBody');
        const viewBtns = document.querySelectorAll('.view-btn');
        
        // Filter elements
        const advancedFilters = document.getElementById('advancedFilters');
        const toggleFiltersBtn = document.getElementById('toggleFilters');
        const filtersContent = document.getElementById('filtersContent');
        const filterStartDate = document.getElementById('filterStartDate');
        const filterEndDate = document.getElementById('filterEndDate');
        const filterSetor = document.getElementById('filterSetor');
        const filterUrgencia = document.getElementById('filterUrgencia');
        const applyFiltersBtn = document.getElementById('applyFilters');
        const clearFiltersBtn = document.getElementById('clearFilters');
        
        // Pagination elements
        const paginationContainer = document.getElementById('paginationContainer');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const pageNumbers = document.getElementById('pageNumbers');
        const paginationInfo = document.getElementById('paginationInfo');
        
        // Stats elements
        const totalRecordsEl = document.getElementById('totalRecords');
        const totalCompaniesEl = document.getElementById('totalCompanies');
        const thisMonthRecordsEl = document.getElementById('thisMonthRecords');
        const highPriorityRecordsEl = document.getElementById('highPriorityRecords');
        
        // User elements
        const currentUserEl = document.getElementById('currentUser');
        const userRoleEl = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');

        // Event Listeners
        loginForm.addEventListener('submit', handleLogin);
        logoutBtn.addEventListener('click', handleLogout);
        themeToggle.addEventListener('click', toggleTheme);
        notificationBell.addEventListener('click', openNotifications);
        markAllReadBtn.addEventListener('click', markAllAsRead);
        newFormBtn.addEventListener('click', openNewForm);
        exportCsvBtn.addEventListener('click', exportData);
        exportPdfBtn.addEventListener('click', exportGlobalPDF);
        searchInput.addEventListener('input', debounce(handleSearch, 300));
        diagnosisForm.addEventListener('submit', saveForm);
        installBtn.addEventListener('click', installApp);
        toggleFiltersBtn.addEventListener('click', toggleFilters);
        
        // Filter events
        applyFiltersBtn.addEventListener('click', applyAdvancedFilters);
        clearFiltersBtn.addEventListener('click', clearAdvancedFilters);
        
        // Pagination events
        prevPageBtn.addEventListener('click', () => changePage(currentPage - 1));
        nextPageBtn.addEventListener('click', () => changePage(currentPage + 1));
        
        // Modal close events
        modalCloseBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.target.closest('.modal').style.display = 'none';
            });
        });
        
        // View toggle events
        viewBtns.forEach(btn => {
            btn.addEventListener('click', () => switchView(btn.dataset.view));
        });
        
        // Tab events
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab')) {
                const tabId = e.target.dataset.tab;
                switchTab(tabId);
            }
        });
        
        // Connectivity events
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);
        
        // Install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.style.display = 'flex';
        });

        // Initialize PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('ServiceWorker registered successfully');
                    
                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        const installingWorker = registration.installing;
                        installingWorker.addEventListener('statechange', () => {
                            if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showToast('Nova versão disponível! Recarregue a página.', 'info');
                            }
                        });
                    });
                })
                .catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
        }

        // Load data from IndexedDB
        async function loadDataFromIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('DiagnosticoERP', 1);
                
                request.onerror = () => reject('Database error');
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    
                    // Load records
                    const transaction = db.transaction(['records', 'notifications'], 'readonly');
                    const recordStore = transaction.objectStore('records');
                    const notificationStore = transaction.objectStore('notifications');
                    
                    const recordRequest = recordStore.getAll();
                    const notificationRequest = notificationStore.getAll();
                    
                    recordRequest.onsuccess = (e) => {
                        records = e.target.result || [];
                        
                        notificationRequest.onsuccess = (e) => {
                            notifications = e.target.result || [];
                            
                            // Load saved user
                            const savedUser = localStorage.getItem('currentUser');
                            if (savedUser) {
                                try {
                                    currentUser = JSON.parse(savedUser);
                                    updateUserInterface();
                                    loginContainer.style.display = 'none';
                                    dashboard.style.display = 'block';
                                    setupPermissions();
                                    updateDashboard();
                                    applyFilters();
                                    updateNotificationBadge();
                                } catch (e) {
                                    localStorage.removeItem('currentUser');
                                }
                            }
                            
                            // Load theme preference
                            const savedTheme = localStorage.getItem('theme');
                            if (savedTheme === 'dark') {
                                document.documentElement.setAttribute('data-theme', 'dark');
                                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                            }
                            
                            resolve();
                        };
                    };
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Create object stores if they don't exist
                    if (!db.objectStoreNames.contains('records')) {
                        db.createObjectStore('records', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('notifications')) {
                        db.createObjectStore('notifications', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('syncQueue')) {
                        db.createObjectStore('syncQueue', { keyPath: 'id', autoIncrement: true });
                    }
                };
            });
        }

        // Save data to IndexedDB
        async function saveDataToIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('DiagnosticoERP', 1);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    
                    // Save records
                    const transaction = db.transaction(['records', 'notifications'], 'readwrite');
                    const recordStore = transaction.objectStore('records');
                    const notificationStore = transaction.objectStore('notifications');
                    
                    // Clear stores before saving
                    recordStore.clear();
                    notificationStore.clear();
                    
                    // Save all records
                    records.forEach(record => {
                        recordStore.add(record);
                    });
                    
                    // Save all notifications
                    notifications.forEach(notification => {
                        notificationStore.add(notification);
                    });
                    
                    transaction.oncomplete = () => resolve();
                    transaction.onerror = () => reject('Transaction error');
                };
                
                request.onerror = () => reject('Database error');
            });
        }

        // Add to sync queue
        async function addToSyncQueue(action, data) {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('DiagnosticoERP', 1);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['syncQueue'], 'readwrite');
                    const store = transaction.objectStore('syncQueue');
                    
                    const syncItem = {
                        action,
                        data,
                        timestamp: new Date().toISOString()
                    };
                    
                    const addRequest = store.add(syncItem);
                    
                    addRequest.onsuccess = () => resolve();
                    addRequest.onerror = () => reject('Error adding to sync queue');
                };
                
                request.onerror = () => reject('Database error');
            });
        }

        // Process sync queue
        async function processSyncQueue() {
            if (!isOnline) return;
            
            const request = indexedDB.open('DiagnosticoERP', 1);
            
            request.onsuccess = async (event) => {
                const db = event.target.result;
                const transaction = db.transaction(['syncQueue'], 'readwrite');
                const store = transaction.objectStore('syncQueue');
                
                const getAllRequest = store.getAll();
                
                getAllRequest.onsuccess = async (e) => {
                    const queueItems = e.target.result;
                    
                    if (queueItems.length === 0) return;
                    
                    showSyncStatus('Sincronizando dados...');
                    
                    for (const item of queueItems) {
                        try {
                            // Process each queue item
                            if (item.action === 'save') {
                                console.log('Syncing record:', item.data);
                                
                                // Check if record already exists
                                const existingIndex = records.findIndex(r => r.id === item.data.id);
                                if (existingIndex >= 0) {
                                    records[existingIndex] = item.data;
                                } else {
                                    records.push(item.data);
                                }
                                
                                // Remove from queue
                                const deleteRequest = store.delete(item.id);
                                deleteRequest.onsuccess = () => {
                                    console.log('Item removed from sync queue');
                                };
                            }
                        } catch (error) {
                            console.error('Error syncing item:', error);
                            showSyncStatus('Erro na sincronização', true);
                        }
                    }
                    
                    // Save updated data
                    await saveDataToIndexedDB();
                    
                    // Update UI
                    updateDashboard();
                    applyFilters();
                    
                    hideSyncStatus();
                    showToast('Dados sincronizados com sucesso!', 'success');
                };
            };
        }

        // Theme Management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update theme toggle icon
            themeToggle.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            
            showToast(`Tema ${newTheme === 'dark' ? 'escuro' : 'claro'} ativado`, 'info');
        }

        // Connectivity Management
        function handleOnline() {
            isOnline = true;
            offlineIndicator.classList.remove('show');
            showToast('Você está online novamente!', 'success');
            
            // Process sync queue
            processSyncQueue();
        }

        function handleOffline() {
            isOnline = false;
            offlineIndicator.classList.add('show');
            showToast('Você está offline. As alterações serão sincronizadas quando voltar online.', 'warning');
        }

        // Show/Hide sync status
        function showSyncStatus(message, isError = false) {
            syncStatus.textContent = message;
            syncStatus.classList.add('show');
            if (isError) {
                syncStatus.classList.add('error');
            }
        }

        function hideSyncStatus() {
            syncStatus.classList.remove('show');
            syncStatus.classList.remove('error');
        }

        // Notification Management
        function addNotification(title, message, type = 'info') {
            const newNotification = {
                id: Date.now(),
                title,
                message,
                type,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.unshift(newNotification);
            
            // Save to IndexedDB
            saveDataToIndexedDB().catch(error => {
                console.error('Error saving notifications:', error);
            });
            
            updateNotificationBadge();
            
            // Show toast notification
            showToast(message, type);
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            notificationBadge.textContent = unreadCount;
            notificationBadge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }

        function openNotifications() {
            notificationsModal.style.display = 'block';
            renderNotifications();
        }

        function renderNotifications() {
            if (notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-bell-slash"></i>
                        </div>
                        <div class="empty-title">Nenhuma notificação</div>
                        <div class="empty-description">Você não tem notificações no momento</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            notifications.forEach(notification => {
                const date = new Date(notification.timestamp);
                const timeAgo = getTimeAgo(date);
                
                html += `
                    <div class="notification-item ${notification.read ? '' : 'unread'}" data-id="${notification.id}">
                        <div class="notification-icon">
                            <i class="fas ${getNotificationIcon(notification.type)}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${timeAgo}</div>
                        </div>
                        <div class="notification-actions">
                            ${!notification.read ? `
                                <button class="btn btn-sm btn-primary" onclick="markAsRead(${notification.id})">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                            <button class="btn btn-sm btn-danger" onclick="deleteNotification(${notification.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            notificationsList.innerHTML = html;
        }

        function getNotificationIcon(type) {
            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            return icons[type] || icons.info;
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return 'agora mesmo';
            
            const intervals = {
                ano: 31536000,
                mês: 2592000,
                dia: 86400,
                hora: 3600,
                minuto: 60
            };
            
            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval > 1 ? 's' : ''} atrás`;
                }
            }
            
            return 'agora mesmo';
        }

        function markAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification) {
                notification.read = true;
                saveDataToIndexedDB();
                updateNotificationBadge();
                renderNotifications();
            }
        }

        function markAllAsRead() {
            notifications.forEach(n => n.read = true);
            saveDataToIndexedDB();
            updateNotificationBadge();
            renderNotifications();
            showToast('Todas as notificações foram marcadas como lidas', 'success');
        }

        function deleteNotification(id) {
            notifications = notifications.filter(n => n.id !== id);
            saveDataToIndexedDB();
            updateNotificationBadge();
            renderNotifications();
        }

        // Authentication
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Predefined credentials
            const users = [
                { username: 'admin', password: 'admin123', role: 'admin' },
                { username: 'funcionario', password: 'func123', role: 'funcionario' }
            ];
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUserInterface();
                
                loginContainer.style.display = 'none';
                dashboard.style.display = 'block';
                
                setupPermissions();
                updateDashboard();
                applyFilters();
                
                addNotification(
                    'Bem-vindo!',
                    `Você fez login como ${user.role === 'admin' ? 'Administrador' : 'Funcionário'}`,
                    'success'
                );
                
                showToast('Login realizado com sucesso!', 'success');
            } else {
                showToast('Usuário ou senha inválidos!', 'error');
            }
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            loginContainer.style.display = 'flex';
            dashboard.style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showToast('Logout realizado com sucesso!', 'info');
        }

        function updateUserInterface() {
            if (!currentUser) return;
            
            currentUserEl.textContent = currentUser.username;
            userRoleEl.textContent = currentUser.role === 'admin' ? 'Administrador' : 'Funcionário';
            userAvatar.textContent = currentUser.username.charAt(0).toUpperCase();
        }

        function setupPermissions() {
            if (!currentUser) return;
            
            // Admin has full access
            if (currentUser.role === 'admin') {
                newFormBtn.style.display = 'inline-flex';
                exportCsvBtn.style.display = 'inline-flex';
                exportPdfBtn.style.display = 'inline-flex';
                advancedFilters.style.display = 'block';
            } 
            // Employee has limited access
            else if (currentUser.role === 'funcionario') {
                newFormBtn.style.display = 'inline-flex';
                exportCsvBtn.style.display = 'none';
                exportPdfBtn.style.display = 'none';
                advancedFilters.style.display = 'none';
            }
        }

        // Dashboard Updates
        function updateDashboard() {
            // Total records
            totalRecordsEl.textContent = records.length;
            
            // Total unique companies
            const uniqueCompanies = new Set();
            records.forEach(record => {
                if (record.data.nome_empresa && record.data.nome_empresa[0]) {
                    uniqueCompanies.add(record.data.nome_empresa[0]);
                }
            });
            totalCompaniesEl.textContent = uniqueCompanies.size;
            
            // Records this month
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const thisMonthRecords = records.filter(record => {
                const recordDate = new Date(record.createdAt);
                return recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear;
            });
            thisMonthRecordsEl.textContent = thisMonthRecords.length;
            
            // High priority records
            const highPriorityRecords = records.filter(record => {
                return record.data.urgencia && record.data.urgencia[0] === 'Alta';
            });
            highPriorityRecordsEl.textContent = highPriorityRecords.length;
        }

        // Filter Management
        function toggleFilters() {
            isFiltersExpanded = !isFiltersExpanded;
            
            if (isFiltersExpanded) {
                filtersContent.style.display = 'block';
                toggleFiltersBtn.innerHTML = '<i class="fas fa-chevron-up"></i>';
            } else {
                filtersContent.style.display = 'none';
                toggleFiltersBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
            }
        }

        function applyAdvancedFilters() {
            const startDate = filterStartDate.value;
            const endDate = filterEndDate.value;
            const setor = filterSetor.value;
            const urgencia = filterUrgencia.value;
            
            filteredRecords = records.filter(record => {
                const recordDate = new Date(record.createdAt);
                
                // Date range filter
                if (startDate && recordDate < new Date(startDate)) return false;
                if (endDate) {
                    const endDateObj = new Date(endDate);
                    endDateObj.setHours(23, 59, 59, 999);
                    if (recordDate > endDateObj) return false;
                }
                
                // Sector filter
                if (setor && record.data.setor && record.data.setor[0] !== setor) return false;
                
                // Urgency filter
                if (urgencia && record.data.urgencia && record.data.urgencia[0] !== urgencia) return false;
                
                return true;
            });
            
            currentPage = 1;
            renderRecords();
            showToast('Filtros aplicados com sucesso!', 'success');
        }

        function clearAdvancedFilters() {
            filterStartDate.value = '';
            filterEndDate.value = '';
            filterSetor.value = '';
            filterUrgencia.value = '';
            
            filteredRecords = [...records];
            currentPage = 1;
            renderRecords();
            showToast('Filtros limpos com sucesso!', 'info');
        }

        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm === '') {
                filteredRecords = [...records];
            } else {
                filteredRecords = records.filter(record => {
                    const nome = record.data.nome_empresa ? record.data.nome_empresa[0].toLowerCase() : '';
                    const setor = record.data.setor ? record.data.setor[0].toLowerCase() : '';
                    
                    return nome.includes(searchTerm) || setor.includes(searchTerm);
                });
            }
            
            currentPage = 1;
            renderRecords();
        }

        function applyFilters() {
            // Apply advanced filters if they are set
            if (filterStartDate.value || filterEndDate.value || filterSetor.value || filterUrgencia.value) {
                applyAdvancedFilters();
            } else {
                filteredRecords = [...records];
                renderRecords();
            }
        }

        // View Management
        function switchView(view) {
            currentView = view;
            
            // Update view buttons
            viewBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            // Show/hide views
            tableView.style.display = view === 'table' ? 'block' : 'none';
            cardsView.style.display = view === 'cards' ? 'grid' : 'none';
            compactView.style.display = view === 'compact' ? 'block' : 'none';
            
            // Re-render records
            renderRecords();
            
            // Save preference
            localStorage.setItem('preferredView', view);
        }

        // Pagination
        function changePage(page) {
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderRecords();
            
            // Scroll to top of records section
            document.querySelector('.records-section').scrollIntoView({ behavior: 'smooth' });
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            
            if (totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            }
            
            paginationContainer.style.display = 'flex';
            
            // Update navigation buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            
            // Generate page numbers
            let pageNumbersHTML = '';
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                pageNumbersHTML += `<button class="page-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) {
                    pageNumbersHTML += `<span>...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                pageNumbersHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbersHTML += `<span>...</span>`;
                }
                pageNumbersHTML += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            pageNumbers.innerHTML = pageNumbersHTML;
            
            // Update pagination info
            const startRecord = (currentPage - 1) * recordsPerPage + 1;
            const endRecord = Math.min(currentPage * recordsPerPage, filteredRecords.length);
            paginationInfo.textContent = `${startRecord}-${endRecord} de ${filteredRecords.length}`;
        }

        // Render Records
        function renderRecords() {
            if (filteredRecords.length === 0) {
                const emptyHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <div class="empty-title">Nenhum questionário encontrado</div>
                        <div class="empty-description">Tente ajustar sua busca ou cadastre um novo questionário</div>
                        <button class="btn btn-primary" onclick="openNewForm()">
                            <i class="fas fa-plus"></i> Novo Questionário
                        </button>
                    </div>
                `;
                
                tableBody.innerHTML = `<tr><td colspan="6">${emptyHTML}</td></tr>`;
                cardsView.innerHTML = emptyHTML;
                compactView.innerHTML = emptyHTML;
                recordCount.textContent = '0 registros';
                paginationContainer.style.display = 'none';
                return;
            }
            
            // Calculate records for current page
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const pageRecords = filteredRecords.slice(startIndex, endIndex);
            
            // Render based on current view
            switch (currentView) {
                case 'table':
                    renderTableView(pageRecords);
                    break;
                case 'cards':
                    renderCardsView(pageRecords);
                    break;
                case 'compact':
                    renderCompactView(pageRecords);
                    break;
            }
            
            // Update record count
            recordCount.textContent = `${filteredRecords.length} registro${filteredRecords.length !== 1 ? 's' : ''}`;
            
            // Render pagination
            renderPagination();
        }

        function renderTableView(pageRecords) {
            let html = '';
            
            pageRecords.forEach(record => {
                const setor = record.data.setor ? record.data.setor[0] : 'Não informado';
                const urgencia = record.data.urgencia ? record.data.urgencia[0] : 'Não informado';
                const data = new Date(record.createdAt).toLocaleDateString('pt-BR');
                
                html += `
                    <tr>
                        <td><span class="record-id">#${record.id}</span></td>
                        <td>
                            <strong>${record.data.nome_empresa ? record.data.nome_empresa[0] : 'Não informado'}</strong>
                        </td>
                        <td>
                            <span class="record-tag tag-sector">${setor}</span>
                        </td>
                        <td>
                            <span class="record-tag tag-urgency-${urgencia.toLowerCase()}">${urgencia}</span>
                        </td>
                        <td>
                            <div class="record-date">
                                <i class="fas fa-calendar"></i> ${data}
                            </div>
                        </td>
                        <td>
                            <div class="record-actions">
                                <button class="btn btn-primary btn-sm" onclick="viewRecord(${record.id})" title="Visualizar">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="editRecord(${record.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-info btn-sm" onclick="exportPDF(${record.id})" title="Exportar PDF">
                                    <i class="fas fa-file-pdf"></i>
                                </button>
                                ${currentUser.role === 'admin' ? `
                                <button class="btn btn-danger btn-sm" onclick="deleteRecord(${record.id})" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function renderCardsView(pageRecords) {
            let html = '';
            
            pageRecords.forEach(record => {
                const setor = record.data.setor ? record.data.setor[0] : 'Não informado';
                const urgencia = record.data.urgencia ? record.data.urgencia[0] : 'Não informado';
                const data = new Date(record.createdAt).toLocaleDateString('pt-BR');
                
                html += `
                    <div class="record-card">
                        <div class="record-card-header">
                            <div>
                                <div class="record-company">${record.data.nome_empresa ? record.data.nome_empresa[0] : 'Não informado'}</div>
                                <div class="record-id">#${record.id}</div>
                            </div>
                        </div>
                        
                        <div class="record-meta">
                            <span class="record-tag tag-sector">${setor}</span>
                            <span class="record-tag tag-urgency-${urgencia.toLowerCase()}">${urgencia}</span>
                        </div>
                        
                        <div class="record-date">
                            <i class="fas fa-calendar"></i> ${data}
                        </div>
                        
                        <div class="record-actions">
                            <button class="btn btn-primary btn-sm" onclick="viewRecord(${record.id})">
                                <i class="fas fa-eye"></i> Visualizar
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="editRecord(${record.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-info btn-sm" onclick="exportPDF(${record.id})">
                                <i class="fas fa-file-pdf"></i> PDF
                            </button>
                            ${currentUser.role === 'admin' ? `
                            <button class="btn btn-danger btn-sm" onclick="deleteRecord(${record.id})">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            cardsView.innerHTML = html;
        }

        function renderCompactView(pageRecords) {
            let html = '';
            
            pageRecords.forEach(record => {
                const setor = record.data.setor ? record.data.setor[0] : 'Não informado';
                const urgencia = record.data.urgencia ? record.data.urgencia[0] : 'Não informado';
                const data = new Date(record.createdAt).toLocaleDateString('pt-BR');
                
                html += `
                    <div class="compact-item">
                        <input type="checkbox" class="compact-checkbox">
                        <div class="compact-content">
                            <div class="compact-info">
                                <div class="compact-company">${record.data.nome_empresa ? record.data.nome_empresa[0] : 'Não informado'}</div>
                                <div class="compact-meta">
                                    <span class="record-tag tag-sector">${setor}</span>
                                    <span class="record-tag tag-urgency-${urgencia.toLowerCase()}">${urgencia}</span>
                                    <span><i class="fas fa-calendar"></i> ${data}</span>
                                </div>
                            </div>
                            <div class="record-actions">
                                <button class="btn btn-primary btn-sm" onclick="viewRecord(${record.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning btn-sm" onclick="editRecord(${record.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-info btn-sm" onclick="exportPDF(${record.id})">
                                    <i class="fas fa-file-pdf"></i>
                                </button>
                                ${currentUser.role === 'admin' ? `
                                <button class="btn btn-danger btn-sm" onclick="deleteRecord(${record.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            compactView.innerHTML = html;
        }

        // Form Management
        function openNewForm() {
            currentEditId = null;
            modalTitle.textContent = 'Novo Questionário de Diagnóstico';
            diagnosisForm.reset();
            formModal.style.display = 'block';
            
            // Reset to first tab
            document.querySelector('.tab').click();
        }

        function closeModal() {
            formModal.style.display = 'none';
        }

        // Tab Management
        function switchTab(tabId) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            
            // Show tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        // Generate form tabs content
        function generateFormTabs() {
            const tabsContainer = document.querySelector('.tabs');
            const formContainer = diagnosisForm;
            
            // Tab content for each section
            const tabContents = {
                perfil: `
                    <div class="tab-content active" id="perfil">
                        <h3 class="section-title">1.1 Dados Básicos</h3>
                        
                        <div class="form-group">
                            <label class="form-label" for="nome_empresa">Nome da empresa</label>
                            <input type="text" id="nome_empresa" class="form-control" placeholder="Digite o nome da empresa" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Setor</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="setor" value="Comércio">
                                    <span>Comércio</span>
                                </label>
                                <label>
                                    <input type="radio" name="setor" value="Saúde">
                                    <span>Saúde</span>
                                </label>
                                <label>
                                    <input type="radio" name="setor" value="Educação">
                                    <span>Educação</span>
                                </label>
                                <label>
                                    <input type="radio" name="setor" value="Construção">
                                    <span>Construção</span>
                                </label>
                                <label>
                                    <input type="radio" name="setor" value="Outro">
                                    <span>Outro:</span>
                                    <input type="text" id="setor_outro" class="form-control" style="width: 150px; display: inline-block; margin-left: 10px;">
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nº de funcionários</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="num_funcionarios" value="1-10">
                                    <span>1-10</span>
                                </label>
                                <label>
                                    <input type="radio" name="num_funcionarios" value="11-50">
                                    <span>11-50</span>
                                </label>
                                <label>
                                    <input type="radio" name="num_funcionarios" value="51-200">
                                    <span>51-200</span>
                                </label>
                                <label>
                                    <input type="radio" name="num_funcionarios" value="200+">
                                    <span>200+</span>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">1.2 Contexto Operacional</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Faturamento mensal</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="faturamento_mensal" value="Até 500K">
                                    <span>Até 500K</span>
                                </label>
                                <label>
                                    <input type="radio" name="faturamento_mensal" value="500K-2M">
                                    <span>500K-2M</span>
                                </label>
                                <label>
                                    <input type="radio" name="faturamento_mensal" value="Acima de 2M">
                                    <span>Acima de 2M</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Possui filiais?</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="possui_filiais" value="Sim">
                                    <span>Sim</span>
                                    <input type="text" id="num_filiais" class="form-control" style="width: 80px; display: inline-block; margin-left: 10px;" placeholder="Nº">
                                </label>
                                <label>
                                    <input type="radio" name="possui_filiais" value="Não">
                                    <span>Não</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                processos: `
                    <div class="tab-content" id="processos">
                        <h3 class="section-title">2.1 Sistemas Atuais</h3>
                        
                        <div class="form-group">
                            <label class="form-label" for="sistema_utilizado">Sistema utilizado</label>
                            <input type="text" id="sistema_utilizado" class="form-control" placeholder="Nome do sistema atual">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tempo de uso</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="tempo_sistema" value="<1 ano">
                                    <span>&lt;1 ano</span>
                                </label>
                                <label>
                                    <input type="radio" name="tempo_sistema" value="1-3 anos">
                                    <span>1-3 anos</span>
                                </label>
                                <label>
                                    <input type="radio" name="tempo_sistema" value=">3 anos">
                                    <span>&gt;3 anos</span>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">2.2 Principais Dores (até 3)</h3>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="dores" value="Processos manuais">
                                    <span>Processos manuais</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="dores" value="Emissão fiscal difícil">
                                    <span>Emissão fiscal difícil</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="dores" value="Falta controle estoque/finanças">
                                    <span>Falta controle estoque/finanças</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="dores" value="Conciliação bancária">
                                    <span>Conciliação bancária</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="dores" value="Outro">
                                    <span>Outro:</span>
                                    <input type="text" id="dores_outro" class="form-control" style="width: 150px; display: inline-block; margin-left: 10px;">
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">2.3 Impacto Financeiro</h3>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="impacto_financeiro" value="Erros de faturação">
                                    <span>Erros de faturação</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="impacto_financeiro" value="Multas fiscais">
                                    <span>Multas fiscais</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="impacto_financeiro" value="Perdas de estoque">
                                    <span>Perdas de estoque</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="impacto_financeiro" value="Não sabe mensurar">
                                    <span>Não sabe mensurar</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                necessidades: `
                    <div class="tab-content" id="necessidades">
                        <h3 class="section-title">3.1 Comércio/Distribuição</h3>
                        
                        <div class="form-group">
                            <label class="form-label" for="num_skus">Nº médio de SKUs</label>
                            <input type="text" id="num_skus" class="form-control" placeholder="Número médio de SKUs">
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="comercio_dores" value="Vendas não registradas">
                                    <span>Vendas não registradas</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="comercio_dores" value="Dificuldade impostos">
                                    <span>Dificuldade impostos</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="comercio_dores" value="Troca preços errados">
                                    <span>Troca preços errados</span>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">3.2 Saúde</h3>
                        
                        <div class="form-group">
                            <label class="form-label" for="num_pacientes">Nº pacientes/mês</label>
                            <input type="text" id="num_pacientes" class="form-control" placeholder="Número de pacientes por mês">
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="saude_dores" value="Agendamentos sobrepostos">
                                    <span>Agendamentos sobrepostos</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="saude_dores" value="Medicamentos vencidos">
                                    <span>Medicamentos vencidos</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="saude_dores" value="Faturação atrasada">
                                    <span>Faturação atrasada</span>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">3.3 Educação</h3>
                        
                        <div class="form-group">
                            <label class="form-label" for="num_alunos">Nº alunos</label>
                            <input type="text" id="num_alunos" class="form-control" placeholder="Número de alunos">
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="educacao_dores" value="Inadimplência">
                                    <span>Inadimplência</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="educacao_dores" value="Controle manual de notas">
                                    <span>Controle manual de notas</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="educacao_dores" value="Comunicação com responsáveis">
                                    <span>Comunicação com responsáveis</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                expectativas: `
                    <div class="tab-content" id="expectativas">
                        <h3 class="section-title">4.1 Critérios de Escolha</h3>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="criterios_escolha" value="Preço">
                                    <span>Preço</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="criterios_escolha" value="Suporte local">
                                    <span>Suporte local</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="criterios_escolha" value="Facilidade de uso">
                                    <span>Facilidade de uso</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="criterios_escolha" value="Certificação AGT">
                                    <span>Certificação AGT</span>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">4.2 Tempo de Implementação</h3>
                        
                        <div class="form-group">
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="tempo_implementacao" value="Imediato (<1 mês)">
                                    <span>Imediato (&lt;1 mês)</span>
                                </label>
                                <label>
                                    <input type="radio" name="tempo_implementacao" value="1-3 meses">
                                    <span>1-3 meses</span>
                                </label>
                                <label>
                                    <input type="radio" name="tempo_implementacao" value="Apenas pesquisando">
                                    <span>Apenas pesquisando</span>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="section-title">4.3 Processo Decisório</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Envolvidos</label>
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" name="envolvidos" value="CEO/Diretor">
                                    <span>CEO/Diretor</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="envolvidos" value="Financeiro">
                                    <span>Financeiro</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="envolvidos" value="TI">
                                    <span>TI</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="envolvidos" value="Outro">
                                    <span>Outro:</span>
                                    <input type="text" id="envolvidos_outro" class="form-control" style="width: 150px; display: inline-block; margin-left: 10px;">
                                </label>
                            </div>
                        </div>
                    </div>
                `,
                analise: `
                    <div class="tab-content" id="analise">
                        <h3 class="section-title">Análise do Consultor</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Urgência</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="urgencia" value="Alta">
                                    <span>Alta</span>
                                </label>
                                <label>
                                    <input type="radio" name="urgencia" value="Média">
                                    <span>Média</span>
                                </label>
                                <label>
                                    <input type="radio" name="urgencia" value="Baixa">
                                    <span>Baixa</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="modulos_prioritarios">Módulos Prioritários</label>
                            <input type="text" id="modulos_prioritarios" class="form-control" placeholder="Módulos prioritários">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="observacoes">Observações</label>
                            <textarea id="observacoes" class="form-control" rows="4" placeholder="Observações adicionais"></textarea>
                        </div>
                    </div>
                `
            };
            
            // Clear existing content
            const existingTabContents = formContainer.querySelectorAll('.tab-content');
            existingTabContents.forEach(content => content.remove());
            
            // Add tab contents
            Object.entries(tabContents).forEach(([tabId, content]) => {
                const tabContent = document.createElement('div');
                tabContent.className = 'tab-content';
                tabContent.id = tabId;
                tabContent.innerHTML = content;
                formContainer.appendChild(tabContent);
            });
        }

        // Save Form
        async function saveForm(e) {
            e.preventDefault();
            
            const formData = new FormData(diagnosisForm);
            const record = {
                id: currentEditId || Date.now(),
                data: {},
                createdAt: currentEditId ? records.find(r => r.id === currentEditId).createdAt : new Date().toISOString(),
                createdBy: currentUser.username
            };
            
            // Collect form data
            for (let [key, value] of formData.entries()) {
                if (!record.data[key]) {
                    record.data[key] = [];
                }
                record.data[key].push(value);
            }
            
            // Handle special fields
            if (formData.get('setor') === 'Outro') {
                record.data.setor = [document.getElementById('setor_outro').value];
            }
            
            if (formData.get('possui_filiais') === 'Sim') {
                record.data.num_filiais = [document.getElementById('num_filiais').value];
            }
            
            if (formData.getAll('dores').includes('Outro')) {
                record.data.dores_outro = [document.getElementById('dores_outro').value];
            }
            
            if (formData.getAll('envolvidos').includes('Outro')) {
                record.data.envolvidos_outro = [document.getElementById('envolvidos_outro').value];
            }
            
            // Add text fields
            record.data.nome_empresa = [document.getElementById('nome_empresa').value];
            record.data.sistema_utilizado = [document.getElementById('sistema_utilizado').value];
            record.data.num_skus = [document.getElementById('num_skus').value];
            record.data.num_pacientes = [document.getElementById('num_pacientes').value];
            record.data.num_alunos = [document.getElementById('num_alunos').value];
            record.data.modulos_prioritarios = [document.getElementById('modulos_prioritarios').value];
            record.data.observacoes = [document.getElementById('observacoes').value];
            
            // Save or update
            if (currentEditId) {
                const index = records.findIndex(r => r.id === currentEditId);
                records[index] = record;
                addNotification(
                    'Questionário Atualizado',
                    `O questionário da empresa "${record.data.nome_empresa[0]}" foi atualizado`,
                    'info'
                );
                showToast('Questionário atualizado com sucesso!', 'success');
            } else {
                records.push(record);
                addNotification(
                    'Novo Questionário',
                    `Um novo questionário foi adicionado para a empresa "${record.data.nome_empresa[0]}"`,
                    'success'
                );
                showToast('Questionário salvo com sucesso!', 'success');
            }
            
            // If offline, add to sync queue
            if (!isOnline) {
                await addToSyncQueue('save', record);
                showToast('Questionário salvo localmente. Será sincronizado quando voltar online.', 'info');
            }
            
            // Save to IndexedDB
            await saveDataToIndexedDB();
            
            updateDashboard();
            applyFilters();
            closeModal();
        }

        // Record Operations
        function viewRecord(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;
            
            // Switch to table view and highlight the record
            switchView('table');
            
            // Find and highlight the record
            const recordRow = tableBody.querySelector(`tr:has([onclick="viewRecord(${id})"])`);
            if (recordRow) {
                recordRow.style.backgroundColor = 'var(--primary-light)';
                recordRow.style.color = 'var(--white)';
                recordRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Remove highlight after 3 seconds
                setTimeout(() => {
                    recordRow.style.backgroundColor = '';
                    recordRow.style.color = '';
                }, 3000);
            }
        }

        function editRecord(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;
            
            currentEditId = id;
            modalTitle.textContent = 'Editar Questionário de Diagnóstico';
            
            // Populate form
            document.getElementById('nome_empresa').value = record.data.nome_empresa ? record.data.nome_empresa[0] : '';
            
            // Sector
            if (record.data.setor) {
                const setorValue = record.data.setor[0];
                if (['Comércio', 'Saúde', 'Educação', 'Construção'].includes(setorValue)) {
                    document.querySelector(`input[name="setor"][value="${setorValue}"]`).checked = true;
                } else {
                    document.querySelector('input[name="setor"][value="Outro"]').checked = true;
                    document.getElementById('setor_outro').value = setorValue;
                }
            }
            
            // Number of employees
            if (record.data.num_funcionarios) {
                document.querySelector(`input[name="num_funcionarios"][value="${record.data.num_funcionarios[0]}"]`).checked = true;
            }
            
            // Revenue
            if (record.data.faturamento_mensal) {
                document.querySelector(`input[name="faturamento_mensal"][value="${record.data.faturamento_mensal[0]}"]`).checked = true;
            }
            
            // Branches
            if (record.data.possui_filiais) {
                document.querySelector(`input[name="possui_filiais"][value="${record.data.possui_filiais[0]}"]`).checked = true;
                if (record.data.possui_filiais[0] === 'Sim' && record.data.num_filiais) {
                    document.getElementById('num_filiais').value = record.data.num_filiais[0];
                }
            }
            
            // Current system
            document.getElementById('sistema_utilizado').value = record.data.sistema_utilizado ? record.data.sistema_utilizado[0] : '';
            
            // System time
            if (record.data.tempo_sistema) {
                document.querySelector(`input[name="tempo_sistema"][value="${record.data.tempo_sistema[0]}"]`).checked = true;
            }
            
            // Pains
            if (record.data.dores) {
                record.data.dores.forEach(dor => {
                    if (dor === 'Outro' && record.data.dores_outro) {
                        document.querySelector('input[name="dores"][value="Outro"]').checked = true;
                        document.getElementById('dores_outro').value = record.data.dores_outro[0];
                    } else {
                        const checkbox = document.querySelector(`input[name="dores"][value="${dor}"]`);
                        if (checkbox) checkbox.checked = true;
                    }
                });
            }
            
            // Financial impact
            if (record.data.impacto_financeiro) {
                record.data.impacto_financeiro.forEach(impacto => {
                    const checkbox = document.querySelector(`input[name="impacto_financeiro"][value="${impacto}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Commerce
            document.getElementById('num_skus').value = record.data.num_skus ? record.data.num_skus[0] : '';
            if (record.data.comercio_dores) {
                record.data.comercio_dores.forEach(dor => {
                    const checkbox = document.querySelector(`input[name="comercio_dores"][value="${dor}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Health
            document.getElementById('num_pacientes').value = record.data.num_pacientes ? record.data.num_pacientes[0] : '';
            if (record.data.saude_dores) {
                record.data.saude_dores.forEach(dor => {
                    const checkbox = document.querySelector(`input[name="saude_dores"][value="${dor}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Education
            document.getElementById('num_alunos').value = record.data.num_alunos ? record.data.num_alunos[0] : '';
            if (record.data.educacao_dores) {
                record.data.educacao_dores.forEach(dor => {
                    const checkbox = document.querySelector(`input[name="educacao_dores"][value="${dor}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Choice criteria
            if (record.data.criterios_escolha) {
                record.data.criterios_escolha.forEach(criterio => {
                    const checkbox = document.querySelector(`input[name="criterios_escolha"][value="${criterio}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }
            
            // Implementation time
            if (record.data.tempo_implementacao) {
                document.querySelector(`input[name="tempo_implementacao"][value="${record.data.tempo_implementacao[0]}"]`).checked = true;
            }
            
            // Involved
            if (record.data.envolvidos) {
                record.data.envolvidos.forEach(envolvido => {
                    if (envolvido === 'Outro' && record.data.envolvidos_outro) {
                        document.querySelector('input[name="envolvidos"][value="Outro"]').checked = true;
                        document.getElementById('envolvidos_outro').value = record.data.envolvidos_outro[0];
                    } else {
                        const checkbox = document.querySelector(`input[name="envolvidos"][value="${envolvido}"]`);
                        if (checkbox) checkbox.checked = true;
                    }
                });
            }
            
            // Urgency
            if (record.data.urgencia) {
                document.querySelector(`input[name="urgencia"][value="${record.data.urgencia[0]}"]`).checked = true;
            }
            
            // Text fields
            document.getElementById('modulos_prioritarios').value = record.data.modulos_prioritarios ? record.data.modulos_prioritarios[0] : '';
            document.getElementById('observacoes').value = record.data.observacoes ? record.data.observacoes[0] : '';
            
            formModal.style.display = 'block';
        }

        async function deleteRecord(id) {
            if (confirm('Tem certeza que deseja excluir este questionário?')) {
                const record = records.find(r => r.id === id);
                records = records.filter(r => r.id !== id);
                
                // If offline, add to sync queue
                if (!isOnline) {
                    await addToSyncQueue('delete', { id });
                    showToast('Questionário excluído localmente. A alteração será sincronizada quando voltar online.', 'info');
                }
                
                await saveDataToIndexedDB();
                
                addNotification(
                    'Questionário Excluído',
                    `O questionário da empresa "${record.data.nome_empresa[0]}" foi excluído`,
                    'warning'
                );
                
                updateDashboard();
                applyFilters();
                showToast('Questionário excluído com sucesso!', 'success');
            }
        }

        // Export Functions
        function exportData() {
            if (records.length === 0) {
                showToast('Nenhum dado para exportar!', 'error');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + "ID,Empresa,Setor,Funcionários,Faturamento,Filiais,Sistema,Tempo Sistema,Dores,Impacto Financeiro,SKUs,Dores Comércio,Pacientes,Dores Saúde,Alunos,Dores Educação,Critérios Escolha,Tempo Implementação,Envolvidos,Urgência,Módulos Prioritários,Observações,Data,Criado Por\n"
                + records.map(record => {
                    const setor = record.data.setor ? record.data.setor[0] : '';
                    const funcionarios = record.data.num_funcionarios ? record.data.num_funcionarios[0] : '';
                    const faturamento = record.data.faturamento_mensal ? record.data.faturamento_mensal[0] : '';
                    const filiais = record.data.possui_filiais ? record.data.possui_filiais[0] : '';
                    const sistema = record.data.sistema_utilizado ? record.data.sistema_utilizado[0] : '';
                    const tempoSistema = record.data.tempo_sistema ? record.data.tempo_sistema[0] : '';
                    const dores = record.data.dores ? record.data.dores.join('; ') : '';
                    const impacto = record.data.impacto_financeiro ? record.data.impacto_financeiro.join('; ') : '';
                    const skus = record.data.num_skus ? record.data.num_skus[0] : '';
                    const doresComercio = record.data.comercio_dores ? record.data.comercio_dores.join('; ') : '';
                    const pacientes = record.data.num_pacientes ? record.data.num_pacientes[0] : '';
                    const doresSaude = record.data.saude_dores ? record.data.saude_dores.join('; ') : '';
                    const alunos = record.data.num_alunos ? record.data.num_alunos[0] : '';
                    const doresEducacao = record.data.educacao_dores ? record.data.educacao_dores.join('; ') : '';
                    const criterios = record.data.criterios_escolha ? record.data.criterios_escolha.join('; ') : '';
                    const tempoImplementacao = record.data.tempo_implementacao ? record.data.tempo_implementacao[0] : '';
                    const envolvidos = record.data.envolvidos ? record.data.envolvidos.join('; ') : '';
                    const urgencia = record.data.urgencia ? record.data.urgencia[0] : '';
                    const modulos = record.data.modulos_prioritarios ? record.data.modulos_prioritarios[0] : '';
                    const observacoes = record.data.observacoes ? record.data.observacoes[0] : '';
                    const data = new Date(record.createdAt).toLocaleDateString('pt-BR');
                    const criadoPor = record.createdBy || '';
                    
                    return `${record.id},"${record.data.nome_empresa ? record.data.nome_empresa[0] : ''}","${setor}","${funcionarios}","${faturamento}","${filiais}","${sistema}","${tempoSistema}","${dores}","${impacto}","${skus}","${doresComercio}","${pacientes}","${doresSaude}","${alunos}","${doresEducacao}","${criterios}","${tempoImplementacao}","${envolvidos}","${urgencia}","${modulos}","${observacoes}","${data}","${criadoPor}"`;
                }).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `diagnostico_erp_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addNotification(
                'Exportação Concluída',
                'Os dados foram exportados com sucesso em formato CSV',
                'success'
            );
            
            showToast('Dados exportados com sucesso!', 'success');
        }

        function exportPDF(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(18);
            doc.text('Questionário de Diagnóstico Avançado – Manda ERP', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text(`ID: ${record.id}`, 20, 25);
            doc.text(`Data: ${new Date(record.createdAt).toLocaleDateString('pt-BR')}`, 20, 30);
            doc.text(`Criado por: ${record.createdBy || 'Não informado'}`, 20, 35);
            
            // Section 1 - Company Profile
            doc.setFontSize(14);
            doc.text('Seção 1 – Perfil da Empresa', 20, 45);
            doc.setFontSize(12);
            
            let yPos = 55;
            doc.text(`Nome da empresa: ${record.data.nome_empresa ? record.data.nome_empresa[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Setor: ${record.data.setor ? record.data.setor[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Nº de funcionários: ${record.data.num_funcionarios ? record.data.num_funcionarios[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Faturamento mensal: ${record.data.faturamento_mensal ? record.data.faturamento_mensal[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            
            let filiaisText = `Possui filiais: ${record.data.possui_filiais ? record.data.possui_filiais[0] : 'Não'}`;
            if (record.data.possui_filiais && record.data.possui_filiais[0] === 'Sim' && record.data.num_filiais) {
                filiaisText += ` (${record.data.num_filiais[0]})`;
            }
            doc.text(filiaisText, 20, yPos);
            yPos += 15;
            
            // Section 2 - Process Diagnosis
            doc.setFontSize(14);
            doc.text('Seção 2 – Diagnóstico de Processos', 20, yPos);
            doc.setFontSize(12);
            yPos += 10;
            
            doc.text(`Sistema utilizado: ${record.data.sistema_utilizado ? record.data.sistema_utilizado[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Tempo de uso: ${record.data.tempo_sistema ? record.data.tempo_sistema[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            
            let doresText = `Principais dores: ${record.data.dores ? record.data.dores.join(', ') : 'Não informado'}`;
            if (record.data.dores && record.data.dores.includes('Outro') && record.data.dores_outro) {
                doresText += ` (${record.data.dores_outro[0]})`;
            }
            doc.text(doresText, 20, yPos);
            yPos += 7;
            doc.text(`Impacto financeiro: ${record.data.impacto_financeiro ? record.data.impacto_financeiro.join(', ') : 'Não informado'}`, 20, yPos);
            yPos += 15;
            
            // Section 3 - Specific Needs
            doc.setFontSize(14);
            doc.text('Seção 3 – Necessidades Específicas', 20, yPos);
            doc.setFontSize(12);
            yPos += 10;
            
            doc.text(`Nº médio de SKUs: ${record.data.num_skus ? record.data.num_skus[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Dores Comércio: ${record.data.comercio_dores ? record.data.comercio_dores.join(', ') : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Nº pacientes/mês: ${record.data.num_pacientes ? record.data.num_pacientes[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Dores Saúde: ${record.data.saude_dores ? record.data.saude_dores.join(', ') : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Nº alunos: ${record.data.num_alunos ? record.data.num_alunos[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Dores Educação: ${record.data.educacao_dores ? record.data.educacao_dores.join(', ') : 'Não informado'}`, 20, yPos);
            yPos += 15;
            
            // Section 4 - Expectations and Decision
            doc.setFontSize(14);
            doc.text('Seção 4 – Expectativas e Decisão', 20, yPos);
            doc.setFontSize(12);
            yPos += 10;
            
            doc.text(`Critérios de escolha: ${record.data.criterios_escolha ? record.data.criterios_escolha.join(', ') : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Tempo de implementação: ${record.data.tempo_implementacao ? record.data.tempo_implementacao[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            
            let envolvidosText = `Envolvidos: ${record.data.envolvidos ? record.data.envolvidos.join(', ') : 'Não informado'}`;
            if (record.data.envolvidos && record.data.envolvidos.includes('Outro') && record.data.envolvidos_outro) {
                envolvidosText += ` (${record.data.envolvidos_outro[0]})`;
            }
            doc.text(envolvidosText, 20, yPos);
            yPos += 15;
            
            // Section 5 - Consultant Analysis
            doc.setFontSize(14);
            doc.text('Seção 5 – Análise do Consultor', 20, yPos);
            doc.setFontSize(12);
            yPos += 10;
            
            doc.text(`Urgência: ${record.data.urgencia ? record.data.urgencia[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            doc.text(`Módulos Prioritários: ${record.data.modulos_prioritarios ? record.data.modulos_prioritarios[0] : 'Não informado'}`, 20, yPos);
            yPos += 7;
            
            // Handle long observations
            const observacoes = record.data.observacoes ? record.data.observacoes[0] : 'Não informado';
            const splitObservacoes = doc.splitTextToSize(observacoes, 170);
            doc.text(splitObservacoes, 20, yPos);
            
            // Save PDF
            doc.save(`Diagnostico_ERP_${record.data.nome_empresa ? record.data.nome_empresa[0] : 'Sem Nome'}_${record.id}.pdf`);
            
            showToast('PDF exportado com sucesso!', 'success');
        }

        function exportGlobalPDF() {
            if (records.length === 0) {
                showToast('Nenhum dado para exportar!', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(18);
            doc.text('Relatório Global - Questionários de Diagnóstico ERP', 105, 15, { align: 'center' });
            doc.setFontSize(12);
            doc.text(`Data de geração: ${new Date().toLocaleDateString('pt-BR')}`, 105, 25, { align: 'center' });
            doc.text(`Total de registros: ${records.length}`, 105, 30, { align: 'center' });
            
            // Prepare table data
            const tableData = records.map(record => [
                record.id,
                record.data.nome_empresa ? record.data.nome_empresa[0] : 'Não informado',
                record.data.setor ? record.data.setor[0] : 'Não informado',
                record.data.num_funcionarios ? record.data.num_funcionarios[0] : 'Não informado',
                record.data.faturamento_mensal ? record.data.faturamento_mensal[0] : 'Não informado',
                record.data.urgencia ? record.data.urgencia[0] : 'Não informado',
                new Date(record.createdAt).toLocaleDateString('pt-BR'),
                record.createdBy || 'Não informado'
            ]);
            
            // Table headers
            const headers = [
                'ID',
                'Empresa',
                'Setor',
                'Funcionários',
                'Faturamento',
                'Urgência',
                'Data',
                'Criado Por'
            ];
            
            // Add table using autoTable
            doc.autoTable({
                head: [headers],
                body: tableData,
                startY: 40,
                theme: 'grid',
                headStyles: {
                    fillColor: [67, 97, 238],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [245, 247, 250]
                },
                margin: { top: 40 }
            });
            
            // Add statistics
            const finalY = doc.lastAutoTable.finalY + 20;
            doc.setFontSize(14);
            doc.text('Estatísticas', 20, finalY);
            doc.setFontSize(12);
            
            // Calculate statistics
            const uniqueCompanies = new Set();
            const sectorCount = {};
            const urgencyCount = {};
            
            records.forEach(record => {
                if (record.data.nome_empresa && record.data.nome_empresa[0]) {
                    uniqueCompanies.add(record.data.nome_empresa[0]);
                }
                
                const setor = record.data.setor ? record.data.setor[0] : 'Não informado';
                sectorCount[setor] = (sectorCount[setor] || 0) + 1;
                
                const urgencia = record.data.urgencia ? record.data.urgencia[0] : 'Não informado';
                urgencyCount[urgencia] = (urgencyCount[urgencia] || 0) + 1;
            });
            
            // Add statistics to PDF
            let statsY = finalY + 10;
            doc.text(`Total de empresas únicas: ${uniqueCompanies.size}`, 20, statsY);
            statsY += 7;
            
            doc.text('Distribuição por setor:', 20, statsY);
            statsY += 7;
            Object.entries(sectorCount).forEach(([setor, count]) => {
                doc.text(`  ${setor}: ${count} (${((count / records.length) * 100).toFixed(1)}%)`, 25, statsY);
                statsY += 7;
            });
            
            statsY += 5;
            doc.text('Distribuição por urgência:', 20, statsY);
            statsY += 7;
            Object.entries(urgencyCount).forEach(([urgencia, count]) => {
                doc.text(`  ${urgencia}: ${count} (${((count / records.length) * 100).toFixed(1)}%)`, 25, statsY);
                statsY += 7;
            });
            
            // Save PDF
            doc.save(`Relatorio_Global_Diagnostico_ERP_${new Date().toISOString().split('T')[0]}.pdf`);
            
            addNotification(
                'Relatório Gerado',
                'O relatório global foi exportado com sucesso em PDF',
                'success'
            );
            
            showToast('Relatório PDF global exportado com sucesso!', 'success');
        }

        // Toast Notifications
        function showToast(message, type = 'info') {
            // Remove existing toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${message}
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add close functionality
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', () => {
                toast.remove();
            });
            
            // Add to DOM
            document.body.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // Install App
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    installBanner.style.display = 'none';
                });
            }
        }

        // Utility Functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Initialize
        async function initialize() {
            // Generate form tabs
            generateFormTabs();
            
            // Load data from IndexedDB
            await loadDataFromIndexedDB();
            
            // Set initial connectivity status
            if (!isOnline) {
                offlineIndicator.classList.add('show');
            }
            
            // Load preferred view
            const preferredView = localStorage.getItem('preferredView');
            if (preferredView) {
                switchView(preferredView);
            }
            
            // Periodic sync check
            setInterval(() => {
                if (isOnline) {
                    processSyncQueue();
                }
            }, 30000);
            
            // Simulate periodic notifications for admin
            if (currentUser && currentUser.role === 'admin') {
                setInterval(() => {
                    // High priority records notification
                    const highPriorityRecords = records.filter(r => 
                        r.data.urgencia && 
                        r.data.urgencia[0] === 'Alta' && 
                        new Date(r.createdAt) > new Date(Date.now() - 24 * 60 * 60 * 1000)
                    );
                    
                    if (highPriorityRecords.length > 0) {
                        addNotification(
                            'Atenção: Registros de Alta Prioridade',
                            `Existem ${highPriorityRecords.length} questionários com urgência alta criados nas últimas 24 horas`,
                            'warning'
                        );
                    }
                    
                    // Inactivity notification
                    const recentRecords = records.filter(r => 
                        new Date(r.createdAt) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
                    );
                    
                    if (recentRecords.length === 0 && records.length > 0) {
                        addNotification(
                            'Inatividade Detectada',
                            'Nenhum novo questionário foi adicionado na última semana',
                            'info'
                        );
                    }
                }, 60000);
            }
        }

        // Start the app
        initialize();
    </script>
</body>
</html>
